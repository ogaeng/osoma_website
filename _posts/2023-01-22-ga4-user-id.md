---
layout: post
division: blog
author: heejun
ids: ga4-user-id
title:  "GA4가 사용자를 식별하는 방법과 사용자 ID(User ID) 수집하기"
permalink: /blog/ga4-user-id/
categories:
  - blog
  - GA
date:   2023-01-22 17:00:00 +9:00
image:  '/images/posts/ga4-user-id/thumb.png'
tags:   [GA, GA4]
description: 구글 애널리틱스 4의 사용자 식별 방법을 이해하고 user_id를 수집하는 방법에 대해 안내합니다.
---

구글 애널리틱스 4(GA4) 보고서를 보면서 총 사용자라는 측정 항목을 보신 적이 있으실 겁니다. 우리가 일반적으로 사용하는 사용자라는 단어의 정의를 생각해보면 이 측정 항목은 우리 사이트에 방문한 사람의 수를 집계하여 보여주는 것으로 생각할 수 있는데요. 구글 애널리틱스 4는 사용자를 명확하게 식별할 수 없는 경우 웹사이트는 쿠키 내 클라이언트 ID, 앱은 앱 인스턴스 ID를 기반으로 만들어진 기기 ID로 사용자를 판단하기 때문에 대부분의 서비스의 총 사용자 수는 과대 계산되어 있을 가능성이 높습니다. 이번 글에서는 구글 애널리틱스 4가 어떻게 사용자를 식별하는지 그리고 더 정확하게 사용자를 식별하기 위해서 구현이 필요한 User ID(사용자 ID)에 대해 알아보도록 하겠습니다.

## 목차

1. [GA4 웹사이트 기기 ID - 클라이언트 ID(Client ID)](#chapter1)
2. [GA4 앱 기기 ID - 앱 인스턴스 ID(App Instance ID)](#chapter2)
3. [구글이 만든 사용자 식별자 - 구글 신호 데이터(Google signals)](#chapter3)
4. [불확실한 사용자 식별자가 GA4에 미치는 영향](#chapter4)
5. [비즈니스가 설정하는 고유의 사용자 식별자 - 사용자 ID(User ID)](#chapter5)
6. [GA4에 User ID 세팅하기](#chapter6)
7. [GA4에 전달한 User ID 활용하여 사용자 개별 행동 확인하기](#chapter7)

<h2 id="chapter1">GA4 웹사이트 기기 ID - 클라이언트 ID(Client ID)</h2>

클라이언트 ID는 기존에 유니버설 애널리틱스(UA)에도 존재했던 구글 애널리틱스의 대표적인 사용자 식별자입니다. 클라이언트 ID는 GA 쿠키를 기반으로 만들어지기 때문에 쿠키에 대해 알 필요가 있습니다. 쿠키는 쉽게 말하면 사용자가 웹사이트에 재방문했을 때 웹사이트를 빠르고 편리하게 사용할 수 있도록 저장한 작은 데이터 조각이라고 정의할 수 있습니다. 웹사이트에 **구글 애널리틱스 코드를 넣으면 사이트에 처음 방문했을 때 GA 쿠키가 생성되고 임의의 클라이언트 ID가 할당**됩니다. 쿠키는 기기와 사용하고 있는 브라우저 기반으로 만들어지기 때문에 같은 기기 같은 브라우저로만 계속 접속한다면 구글 애널리틱스는 이를 1명의 사용자로 인식할 수 있습니다. 하지만 요즘같이 다수의 기기를 가지고 있고 다양한 브라우저가 존재하는 세상에서 이는 거의 불가능에 가까운 경우의 수입니다. 간단한 예시를 들어보겠습니다.

![클라이언트 ID](/images/posts/ga4-user-id/01.png)

위의 이미지는 1명의 사용자에게 여러 클라이언트 ID가 생길 수 있는 경우를 보여주는 예시입니다. 따라서 아직 User ID를 세팅하지 않은 웹사이트의 경우 구글 애널리틱스 4 보고서에 찍히는 사용자 수를 특정 개인이라고 판단하는 것은 잘못된 해석입니다. 여기서 잊지 않고 숙지해야 할 점은 **기기뿐만 아니라 접속한 브라우저가 바뀌어도 새로운 클라이언트 ID가 생성**된다는 점입니다. 카카오톡과 같이 인앱 브라우저가 실행되는 경로는 다음과 같은 것들이 있습니다.

### 대표적인 인앱 브라우저 예시

- 네이버 앱
- 카카오톡 앱
- 페이스북 앱
- 인스타그램 앱
- 틱톡 앱
- 트위터 앱

인앱 브라우저를 사용하는 플랫폼에는 디지털 마케팅을 진행하면서 유입 경로로 사용되는 플랫폼들이 다수 포함되어 있습니다. 때문에 User ID 기능을 사용하지 않는 경우 구글 애널리틱스 4 보고서의 사용자 수는 과대 보고되고 있을 가능성이 높습니다.

<h2 id="chapter2">GA4 앱 기기 ID - 앱 인스턴스 ID(App Instance ID)</h2>

앱 인스턴스 ID는 앱 개발자가 [파이어베이스를 설치할 때 구현](https://firebase.google.com/docs/reference/android/com/google/firebase/installations/FirebaseInstallations?hl=ko){:target="_blank"}이 필요합니다. 앱 인스턴스 ID는 앱을 설치한 후에 할당되는 임의의 식별자이며 다음과 같은 경우가 아니면 변하지 않고 유지되는 식별자입니다.

### 앱 인스턴스 ID가 변하는 경우

1. 앱이 인스턴스 ID를 삭제하는 경우
2. 새로운 기기에서 앱이 복원되는 경우
3. 사용자가 앱을 제거 후 재설치하는 경우
4. 사용자가 앱 데이터를 지운 경우

앱을 사용하다 보면 오류로 인해 재설치를 하거나 앱 관리자에서 저장된 데이터를 지우는 경우가 꽤 발생합니다. 또한 여러 개의 핸드폰을 사용하거나 테블릿을 함께 사용하는 경우에도 1명이 여러 개의 앱 인스턴스 ID를 가질 수 있기 때문에 클라이언트 ID처럼 사용자가 과대 계산되는 원인이 됩니다.

<h2 id="chapter3">구글이 만든 사용자 식별자 - 구글 신호 데이터(Google signals)</h2>

구글 신호 데이터는 **사용자가 로그인한 구글 ID를 기반으로 사용자를 식별**합니다. 익명으로 수집되기 때문에 특정 사용자가 어떤 식별자를 가졌는지는 확인이 불가능합니다. 구글 ID를 기반으로 만들어지기 때문에 데스크톱, 스마트폰, 태블릿에 모두 같은 구글 ID로 로그인이 되어 있다면 1명의 사용자로 인식하여 데이터를 수집하게 됩니다.

### 구글 신호 데이터가 활용되는 경우

다음을 사용하여 Google 계정에 로그인할 때 구글 신호 데이터를 활용하여 추적됩니다.

1. iOS 기기
2. Android 기기
3. ChromeOS
4. Chrome 웹브라우저
5. 기타 웹브라우저
6. Google 계정이 필요한 클라이언트 앱
7. Google 계정이 필요한 기타 앱

![신호데이터 수집](/images/posts/ga4-user-id/02.png)

구글 신호 데이터를 수집하는 것에 동의해야만 인구통계, 관심 분야에 대한 데이터를 얻을 수 있기 때문에 대부분의 GA4를 사용하는 서비스라면 이미 구글 신호 데이터로도 사용자를 식별하고 있을 가능성이 높습니다. 구글 신호 데이터는 앞서 알아본 클라이언트 ID, 앱 인스턴스 ID보다는 사용자를 정확하게 인식하여 데이터를 수집해주지만, 이 역시 완벽하지는 않습니다. 한계점에 대해 알아보도록 하겠습니다.

### 구글 신호 데이터의 한계점

1. 정확한 교차기기 보고를 위해서는 모든 기기에 같은 구글 ID가 로그인되어 있어야 합니다.
2. 사용자가 광고 개인 최적화를 비활성화한 경우 구글 신호 데이터를 사용할 수 없습니다.
구글의 광고 개인 최적화 기능은 아직 디폴트로 활성화를 유지하고 있지만 최근 강화되는 개인정보 보호 강화 정책에 따라 언제든지 애플의 ATT처럼 옵트인(opt-in) 방식으로 전환될 수 있습니다.
3. Google 신호 데이터는 iOS 14 이상 버전의 기기를 지원하지 않습니다.

<h2 id="chapter4">불확실한 사용자 식별자가 GA4에 미치는 영향</h2>

### 1. 정확한 사용자 수를 제공할 수 없습니다.

1명의 사용자가 여러 개의 식별자를 가질 수 있는 다양한 상황이 존재하기 때문에 GA4의 사용자 수 과대하게 집계될 수밖에 없습니다.

### 2. 정확한 교차 기기 측정이 어렵습니다.

구글 신호 데이터를 제외하고 클라이언트 ID, 앱 인스턴스 ID는 기기가 바뀔 때 식별자도 새로 생성되기 때문에 교차 기기 간 활동을 측정하는 것이 불가능합니다. 구글 신호 데이터의 경우에도 사용하고 있는 iOS 기기의 OS 버전이 14 이상이라면 측정이 불가능합니다.
애플은 자동 업데이트가 강제되기 때문에 현재 대부분의 iOS 기기는 14 이상의 버전일 가능성이 높습니다.

### 3. 정확한 기여 분석이 어렵습니다.

한 사람이 다수의 기기로 여러 유입 경로를 거쳤더라도 개별 사용자로 인식되기 때문에 유입 경로가 따로 기록됩니다. 그래서 구글은 이에 대한 대책으로 **교차 채널 데이터 기반 모델**이라는 기여 분석 모델을 만들어 추측을 통해 전환 채널에 대한 기여 정보를 제공합니다. 자세한 내용은 오픈소스마케팅 블로그의 [GA4 기여 분석 이해하고 활용하기 글](https://osoma.kr/blog/ga4-attribution-model/){:target="_blank"}에서 더 확인하실 수 있습니다.

이처럼 GA4에서 특별한 설정 없이 사용되는 사용자 식별자를 이용하면 분석의 정확도에 큰 영향을 미칩니다. 그래서 GA4에서는 사용자의 상호 작용을 여러 장치와 플랫폼에서 추적하고 분석할 수 있도록 해주는 기능인 User ID(사용자 ID)를 제공합니다.

<h2 id="chapter5">비즈니스가 설정하는 고유의 사용자 식별자 - 사용자 ID(User ID)</h2>

User ID는 위에서 언급한 클라이언트 ID, 앱 인스턴스 ID, 구글 신호 데이터와 다르게  개인을 식별할 수 있는 고유의 식별자입니다. 일반적으로 로그인한 사용자에게 부여하여 여러 기기, 브라우저에서 **같은 회원 ID로 로그인하여 활동하는 경우 이 활동들을 하나로 통합하여 하나의 사용자 여정으로 확인**할 수 있게 해줍니다.

![User ID](/images/posts/ga4-user-id/03.png)

비즈니스에 가입 및 로그인 기능이 있어야 활용 가능하다는 한계가 있지만 요즘 이슈가 되는 웹사이트 쿠키 제한 환경, IOS 14 개인정보보호 강화 환경에서도 안정적으로 교차 기기 데이터를 수집할 수 있습니다. 구글 애널리틱스 4 User ID 기능에는 몇 가지 제한 사항이 존재하니 꼭 확인해주세요.

### 구글 애널리틱스 4 User ID 제한사항

1. Google에서 개인을 식별할 수 있는 데이터 (예: 특정 이름, 주민등록번호, 이메일 주소, 기타 유사 데이터) 또는 특정 기기를 영구적으로 나타내는 데이터(예: 재설정할 수 없는 고유한 기기 식별자)를 업로드해서는 안 됩니다.
2. Google 애널리틱스로 전송하는 사용자 ID는 256자(영문 기준) 미만이어야 합니다.
3. 구현 전에 수집 및 기록된 애널리틱스 계정의 모든 데이터는 재처리되지 않고 사용자 ID와 연결되지 않습니다.
4. 한 속성에서 수집된 User-ID 데이터를 다른 속성의 데이터와 공유하거나 혼합할 수 없습니다.

1번 제한 사항은 개인을 식별할 수 있는 데이터를 적절한 암호화 수준을 거쳐 암호화한다면 식별이 불가능해져서 User ID로 활용이 가능합니다. 구글에서는 이 공식적인 규칙을 다음과 같이 정의하고 있습니다.

> SHA256이라는 최소 해싱 요구사항을 갖추고 있으며, 최소 8자의 솔트를 사용할 것을 권장합니다.

담당하고 계신 서비스에서 임의의 회원 ID가 아닌 이메일 주소, 회원 번호 등을 User ID로 사용하고자 한다면 개발자에게 해당 규칙을 꼭 전달해주세요.

<h2 id="chapter6">GA4에 User ID 세팅하기</h2>

구글태그매니저를 사용하여 어떤 사용자인지 식별하는 기준이 되는 User ID를 세팅하는 경우 사용자 속성 탭이 아닌 **설정할 필드 또는 이벤트 매개변수 탭에 추가할 것**과 매개변수의 이름을 구글이 **규칙으로 정해둔 'user_id'를 사용할 것**을 가이드에 명시하고 있습니다. 그래서 일반 사용자 속성과 세팅하는 법이 달라 어려움을 겪고는 하시는데요. 제대로 설정하는 방법에 대해 알아보도록 하겠습니다. 아직 사용자 속성에 대해 잘 모르신다면 [구글 애널리틱스 4 사용자 속성 이해하기](https://osoma.kr/blog/ga4-user-property/){:target="_blank"} 글을 참고해보세요.

![GTM - User ID](/images/posts/ga4-user-id/04.png)

구글태그매니저에서 태그 설정을 GA4 구성, GA4 이벤트로 설정하면 설정한 필드 또는 이벤트 매개변수라는 탭이 존재합니다. 그곳에서 행 추가를 눌러 필드 이름 또는 매개변수 이름을 **구글이 공식으로 정한 user_id로 사용**하고 값에 user_id 변수를 넣어주면 세팅이 완료됩니다.

### gtag(직접 사이트에 코드 설치)로 User ID 설정하기

{% highlight javascript %}
{% raw %}

gtag('config', 'G-XXXXXXXX', {
  'user_id': '{USER_ID}'
});

{% endraw %}
{% endhighlight %}

기존 사이트에 설치된 구성 태그에 user_id를 넣어 GA4로 전달할 수 있습니다. user_id 정보 역시 서버에서 가져오기 때문에 [개발자와 꼭 협력이 필요](https://developers.google.com/analytics/devguides/collection/ga4/user-id?technology=gtagjs&client_type=gtm){:target="_blank"}합니다.

user_id의 경우 이미 예약된 속성 이름이기 때문에 **다른 사용자 속성처럼 맞춤 측정 기준을 만들 필요는 없습니다.** GA4에서 User ID를 확인하는 방법은 뒤에 이어질 'GA4에 전달한 User ID 활용하여 사용자 개별 행동 확인하기' 챕터에서 설명해 드리도록 할게요.

<h2 id="chapter7">GA4에 전달한 User ID 활용하여 사용자 개별 행동 확인하기</h2>

구글에서 User ID를 사용자 속성이 아닌 이벤트 매개변수로 전달하라고 하고 있기 때문에 참여 탭 내 이벤트 보고서에서 User ID를 확인할 수 있다고 알고 계시는 경우가 많습니다. 실제로 이벤트 보고서에 User ID가 보이지 않아서 잘못 세팅되었다고 판단할 수가 있는데 이는 틀린 판단입니다. **GA4에서 user_id는 예약된 속성 이름이므로, 보고서 및 탐색 분석에서 바로 액세스할 수는 없습니다.** user_id가 정상적으로 수집되는 경우 기존에 GA4에서 수집했던 기기 ID(웹사이트는 클라이언트 ID / 앱은 고유한 앱 설치를 나타내는 앱 인스턴스 ID)가 User ID로 변하여 보이게 됩니다. 이 변화된 User ID를 확인할 수 있는 보고서에 대해 알아보도록 하겠습니다.

### 1. GA4에서 탐색 탭에 들어갑니다.

![탐색](/images/posts/ga4-user-id/05.png)

### 2. 템플릿 끝에 있는 화살표를 눌러 사용자 개별화 분석을 클릭합니다.

![사용자 개별화 분석](/images/posts/ga4-user-id/06.png)

### 3. User ID를 적용한 경우 앱 인스턴스 ID(기기 ID) 열에 User ID가 보입니다.

![사용자 개별화 분석 표](/images/posts/ga4-user-id/07.png)

### 4. User ID 또는 앱 인스턴스 ID를 클릭하면 사용자 기반의 다양한 정보를 알 수 있습니다.

![사용자 정보](/images/posts/ga4-user-id/08.png)

사용자 개별화 분석 보고서에서는 이벤트로 세팅해둔 사용자 행동이 개별적으로 보이기 때문에 로열티가 높은 유저나, 구매 단가가 큰 고객, 자주 구매하는 고객 등 **특정 고객의 개별 행동을 이해**하는 데 도움이 됩니다. 이벤트뿐만 아니라 오류도 기록되기 때문에 **오류가 발생한 상황, 사용하고 있는 브라우저, 사용하고 있는 기기를 빠르게 판단**하여 개발자에 전달해줄 수 있습니다.

오늘은 GA4를 세팅하면서 많이들 의문점을 갖는 User ID(사용자 ID)와 User ID가 필요한 이유에 대해 알아봤습니다. User ID 기능을 구현하기 전에 먼저 수집된 데이터는 추후에 소급 적용되어 구현 후 만들어진 User ID에 연결되지 않습니다. 그래서 로그인 기능을 가진 서비스를 담당하고 계신다면 GA4를 처음 세팅할 때 User ID 기능을 바로 구현하실 것을 권장드립니다.
